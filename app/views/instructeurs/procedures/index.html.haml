- content_for(:title, "Démarches")

.container
  %h1.page-title Démarches

  %ul.procedure-list
    - @groupe_instructeurs.each do |groupe_instructeur|
      %li.procedure-item.flex.align-start
        = link_to(instructeur_groupe_instructeur_path(groupe_instructeur)) do
          - procedure = groupe_instructeur.procedure
          .flex

            .procedure-logo{ style: "background-image: url(#{procedure.logo_url})" }

            .procedure-details
              %p.procedure-title
                = procedure_libelle(procedure)

              %ul.procedure-stats.flex
                %li
                  %object
                    = link_to(instructeur_groupe_instructeur_path(groupe_instructeur, statut: 'a-suivre')) do
                      - a_suivre_count = @dossiers_a_suivre_count_per_groupe_instructeur[groupe_instructeur.id] || 0
                      .stats-number
                        = a_suivre_count
                      .stats-legend
                        à suivre
                %li
                  %object
                    = link_to(instructeur_groupe_instructeur_path(groupe_instructeur, statut: 'suivis')) do
                      - if current_instructeur.notifications_per_procedure[groupe_instructeur.id].present?
                        %span.notifications{ 'aria-label': "notifications" }
                      - followed_count = @followed_dossiers_count_per_groupe_instructeur[groupe_instructeur.id] || 0
                      .stats-number
                        = followed_count
                      .stats-legend
                        = t('pluralize.followed', count: followed_count)
                %li
                  %object
                    = link_to(instructeur_groupe_instructeur_path(groupe_instructeur, statut: 'traites')) do
                      - if current_instructeur.notifications_per_procedure(:termine)[groupe_instructeur.id].present?
                        %span.notifications{ 'aria-label': "notifications" }
                      - termines_count = @dossiers_termines_count_per_groupe_instructeur[groupe_instructeur.id] || 0
                      .stats-number
                        = termines_count
                      .stats-legend
                        = t('pluralize.processed', count: termines_count)
                %li
                  %object
                    = link_to(instructeur_groupe_instructeur_path(groupe_instructeur, statut: 'tous')) do
                      - dossier_count = @dossiers_count_per_groupe_instructeur[groupe_instructeur.id] || 0
                      .stats-number
                        = dossier_count
                      .stats-legend
                        = t('pluralize.case', count: dossier_count)
                %li
                  %object
                    = link_to(instructeur_groupe_instructeur_path(groupe_instructeur, statut: 'archives')) do
                      - archived_count = @dossiers_archived_count_per_groupe_instructeur[groupe_instructeur.id] || 0
                      .stats-number
                        = archived_count
                      .stats-legend
                        = t('pluralize.archived', count: archived_count)

            - if procedure.archivee?
              .procedure-status
                %span.label Archivée
