#avis-show
  = render partial: 'header', locals: { avis: @avis, dossier: @dossier }

.container
  %section.give-avis
    %h1 Donner votre avis
    %p.avis-notice= "#{@avis.claimant.email}: #{@avis.introduction}"

    = form_for @avis, url: avis_path(@avis), html: { class: 'form' } do |f|
      = f.text_area :answer, rows: 3, placeholder: 'Votre avis', required: true
      .send-wrapper
        = f.submit 'Envoyer votre avis', class: 'button send'

  %section.ask-avis
    %h1 Inviter une personne à donner son avis
    %p.avis-notice Elle pourra consulter, donner un avis sur le dossier et contribuer au fil de messagerie, mais elle ne pourra le modifier.

    = form_for Avis.new, url: avis_dossier_path(@dossier.procedure, @dossier), html: { class: 'form' } do |f|
      = f.email_field :email, placeholder: 'Adresse email', required: true
      = f.text_area :introduction, rows: 3, value: 'Bonjour, merci de me donner votre avis sur ce dossier.', required: true
      .send-wrapper
        = f.submit 'Demander un avis', class: 'button send'

  - if @dossier.avis.present?
    %section.list-avis
      %h1.title
        Avis des invités
        %span.count= @dossier.avis.count

      %ul
        - @dossier.avis.each do |avis|
          %li.one-avis
            %h2.claimant
              = (avis.claimant.email == current_gestionnaire.email) ? 'Vous' : avis.claimant.email
              %span.date Demande d'avis envoyée le #{I18n.l(avis.created_at.localtime, format: '%d/%m/%y')}
            %p= avis.introduction

            .answer.flex.align-start
              %i.bubble.avis-icon
              .width-100
                %h2.gestionnaire
                  = avis.gestionnaire.email
                  - if avis.answer.present?
                    %span.date Réponse donnée le #{I18n.l(avis.updated_at.localtime, format: '%d/%m/%y')}
                  - else
                    %span.waiting En attente de réponse
                %p= avis.answer
