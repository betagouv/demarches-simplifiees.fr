= render partial: "header", locals: { dossier: @dossier }

.container
  .card
    .card-title Identité du demandeur
    - if @dossier.entreprise.present?
      = render partial: "identite_entreprise", locals: { entreprise: @dossier.entreprise }

    - if @dossier.individual.present?
      = render partial: "identite_individual", locals: { individual: @dossier.individual }

  .backoffice-title Formulaire

  .card.featured
    - champs = @dossier.ordered_champs.decorate
    - if champs.any?
      = render partial: "champs", locals: { champs: champs }

  - if @dossier.procedure.module_api_carto.present?
    = render partial: "map", locals: { dossier: @dossier }

  - if @dossier.procedure.cerfa_flag? || @dossier.types_de_piece_justificative.any?
    .card.featured
      .card-title Pièces jointes

      %table.table.vertical
        %tbody
          - if @dossier.procedure.cerfa_flag?
            %tr
              %th Formulaire :
              %td
                - if @dossier.cerfa_available?
                  = link_to "Télécharger", @dossier.cerfa.last.content_url, class: "button", target: :blank
                - else
                  Pièce non fournie

          - @dossier.procedure.types_de_piece_justificative.each do |type_de_piece_justificative|
            %tr
              %th= "#{type_de_piece_justificative.libelle} :"
              %td
                - pj = @dossier.retrieve_last_piece_justificative_by_type(type_de_piece_justificative.id)
                - if pj.present?
                  = link_to "Télécharger", pj.content_url, class: "button", target: :blank
                - else
                  Pièce non fournie
